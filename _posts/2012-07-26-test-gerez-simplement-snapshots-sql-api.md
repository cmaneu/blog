---
layout: post
title: [Web Test] Gérez simplement les snapshots de vos bases SQL
slug: test-gerez-simplement-snapshots-sql-api
date: 2012-07-26 08:10:00Z
---

<p>Je suis intervenu récemment sur un projet pour mettre en place des tests de non-régression et des tests de performances pour une application ASP.net. Ces tests ont été réalisés avec les outils disponibles dans Visual Studio 2010.</p> <p>Dans le cadre de ces tests, il était nécessaire de restaurer le contenu de la base de données à son étét d’avant test. En effet, les scénarios de tests incluaient la création d’éléments, et le verrouillage de certaines opérations métiers après une première exécution (exemple: ne pas valider deux fois un remboursement).</p> <p>J’ai donc voulu intégrer au scénario de test l’appel à un web service qui se chargerait de créer un snapshot, puis de restaurer ma base à partir de ce snapshot.</p> <h1></h1> <h1>Une API REST pour réaliser des opérations sur les snapshots</h1> <p>J’ai donc développé <strong>SQL Snapshot Manager</strong>, une API en mode REST (basée sur Web API) qui vous permet simplement de : </p> <ul> <li>Réaliser un snapshot de votre base : api/snapshot/create?server=srvdb01&amp;instance=SQL2012&amp;db=MaBase&amp;snapshot=Mabase_Pretest</li> <li>Restaurer un snapshot de votre base : api/snapshot/restore?server=srvdb01&amp;instance=SQL2012&amp;db=MaBase&amp;snapshot=Mabase_Pretest</li> <li>Supprimer un snapshot : api/snapshot/delete?server=srvdb01&amp;instance=SQL2012&amp;snapshot=Mabase_Pretest</li> <li>Lister les bases qui ont un snapshot, et les noms des snapshots en question : api/snapshot/list?server=srvdb01&amp;instance=SQL2012</li></ul> <p>Cette API n’a peut-être pas une qualité à toute épreuve (même si il y a quelques tests unitaires), mais cela peut vous faire une bonne base de travail. Vous pouvez télécharger le site sur <a title="https://github.com/cmaneu/SqlSnapshotManager/downloads" href="https://github.com/cmaneu/SqlSnapshotManager/downloads">https://github.com/cmaneu/SqlSnapshotManager/downloads</a>.</p> <h1>Une librairie open-source en cadeau</h1> <p>Pour réaliser cette API, je me suis appuyé sur SQL Server management objects (SMO), une librarie Microsoft permettant de gérer son serveur SQL. J’ai construit un wrapper simplifiant la gestion des snapshots (créer les bons filegroups, etc…).</p> <p>Cette librairie open source est disponible sur github : <a href="https://github.com/cmaneu/SqlSnapshotManager"><strong>https://github.com/cmaneu/SqlSnapshotManager</strong></a><strong>.</strong></p> <p>Si vous avez des remarques, n’hésitez pas à poster sur Github ;).</p>
