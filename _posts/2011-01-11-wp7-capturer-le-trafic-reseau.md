---
layout: post
title: WP7 – Capturer le trafic réseau
slug: wp7-capturer-le-trafic-reseau
date: 2011-01-11 13:01:42Z
---

<blockquote>   <p><strong>Update</strong>&#160; : Le développeur de Fiddler nous explique comment l’utiliser pour capturer le trafic réseau d’un téléphone. La technique est un petit peu longue, mais vous pourrez retrouver votre outil préféré. <a href="http://blogs.msdn.com/b/fiddler/archive/2011/01/09/debugging-windows-phone-7-device-traffic-with-fiddler.aspx">La solution sur son blog</a>.</p> </blockquote>  <p>&#160;</p>  <p>&#160;</p>  <p>Les applications Windows Phone 7 utilisent massivement les services <em>cloud</em>. En tant que développeur, on a souvent le besoin de pouvoir capturer le trafic réseau sortant de notre application. La plupart du temps, on utilise <a href="http://www.fiddler2.com/fiddler2/"><strong>Fiddler</strong></a> pour cela. Cet outil bien pratique ne fonctionne malheureusement pas nativement avec les outils Windows Phone. <a href="http://twitter.com/willj">@willj</a> a publié un post sur son blog expliquant <a href="http://www.madebywill.net/2010/08/22/wp7-emulator-fiddler/">comment configurer Fiddler et son système pour capturer le trafic de l’émulateur</a>. Mais comment capturer ce qui sort de votre téléphone ? Nous allons voir cela !</p>  <h2>Welcome Network Monitor</h2>  <p>Pour notre capture, nous allons utiliser <strong><a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=983b941d-06cb-4658-b7f6-3088333d062f&amp;displaylang=en">Microsoft Network Monitor</a></strong>, un outil gratuit permettant d’analyser le trafic réseau (parmi d’autres :).</p>  <h2>Capturer le trafic de l’émulateur</h2>  <p>Network Monitor permet de capturer tout le trafic sortant, cependant cela représente vite beaucoup de données à traiter. Nous allons donc limiter la capture au trafic sortant de l’émulateur : </p>  <ul>   <li>Lancer Network Monitor </li>    <li>Cliquer sur <em>New Capture, </em></li>    <li>Cliquer sur <em>Capture Settings</em>, </li>    <li>Dans <em>Current Capture filter</em>, taper <font size="2" face="Consolas">ProcessName==&quot;XDE.exe&quot;</font> </li>    <li><u>Ne pas oublier</u> de cliquer sur <em>apply</em> avant de cliquer sur <em>close</em>. </li> </ul>  <p><a href="http://blog.maneu.org/wp-content/uploads/2011/01/SNAGHTML6c00bd.png"><img style="background-image: none; border-right-width: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="SNAGHTML6c00bd" border="0" alt="SNAGHTML6c00bd" src="http://blog.maneu.org/wp-content/uploads/2011/01/SNAGHTML6c00bd_thumb.png" width="619" height="464" /></a></p>  <p>Vous pouvez ensuite cliquer sur “start” et observer le trafic. Par exemple, ici, une requête HTTP GET vers mon blog.</p>  <p><a href="http://blog.maneu.org/wp-content/uploads/2011/01/SNAGHTML78ea21.png"><img style="background-image: none; border-right-width: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="SNAGHTML78ea21" border="0" alt="SNAGHTML78ea21" src="http://blog.maneu.org/wp-content/uploads/2011/01/SNAGHTML78ea21_thumb.png" width="622" height="526" /></a></p>  <p>Il ne vous reste plus qu’à analyser le trafic !</p>  <h2>Capturer le trafic du téléphone/device</h2>  <p>La capture du trafic de l’émulateur est une bonne chose, cependant vous pouvez avoir besoin de capturer le trafic depuis le téléphone (comportement différent, utilisation des fonctionnalités du téléphone non présentes dans l’émulateur, etc…).</p>  <p>Le téléphone peut se connecter au réseau par Wifi, et biensur, via votre forfait data. Il est également capable d’utiliser la connexion internet de votre ordinateur si il est relié, et si Zune est lancé avec le téléphone reconnu. C’est en utilisant cette dernière connectivité qu’il nous est possible d’écouter le téléphone.</p>  <p>Pour se faire, un process est chargé d’assurer la connectivité entre le téléphone et votre réseau : WMZuneComm.exe. On peut donc utiliser Network monitor avec ce filtre là.</p>  <p>Il y a cependant une petite astuce : WMZuneComm n’est pas exécuté avec les droits de l’utilisateur courant, vous devez donc lancer Network monitor en mode administrateur pour que cela fonctionne. Dans le cas contraire, le nom du processus est vu comme <em>unknow</em>, et il faudrait alors faire par le PID (en utilisant par exemple process explorer).</p>  <p>Pour la version simple : </p>  <ul>   <li>Passer votre téléphone en mode avion (ou couper l’accès data et wifi manuellement) </li>    <li>Lancer Network Monitor <u>en mode administrateur</u> </li>    <li>Cliquer sur <em>New Capture, </em></li>    <li>Cliquer sur <em>Capture Settings</em>, </li>    <li>Dans <em>Current Capture filter</em>, taper <font size="2" face="Consolas">ProcessName==&quot;WMZuneComm.exe&quot;</font> </li>    <li><u>Ne pas oublier</u> de cliquer sur <em>apply</em> avant de cliquer sur <em>close</em>. </li> </ul>  <p>Il ne vous reste plus qu’à plonger dans les résultats de votre capture. Bon débogages :)</p>
